;/*FB_PKG_DELIM*/

__d("ResumableUploadServiceBlue",["AsyncRequest","ConstUriUtils","EventEmitter","Promise","ResumableUploadServiceState.enum","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i="rupload",j="facebook.com";a=function(a){function e(b,d,e,f,g,h,k,l,m,n,o,p){var q;q=a.call(this)||this;q.consumer=b;q.accessToken=d;q.sessionKey=e||c("uuidv4")();q.contentKey=f||"";q.contentValue=g||"";q.serviceName=h&&h!=""?h:i;q.serviceDomain=k&&k!=""?k:j;q.receiveParameters=l;q.skipOffsetFetching=m;q.thriftParams=n!=null?n:new Map();q.tracingHeaderValue=o;q.customHttpHeaders=p!=null?p:new Map();return q}babelHelpers.inheritsLoose(e,a);e.create=function(a){return new e(a.consumer,a.accessToken,a.sessionKey||"",a.contentKey,a.contentValue,a.serviceName,a.serviceDomain,a.receiveParameters,a.skipOffsetFetching,a.thriftParams,a.tracingHeaderValue,a.customHttpHeaders)};var f=e.prototype;f.$ResumableUploadServiceBlue$p_1=function(a){var b;if(((b=this.receiveParameters)==null?void 0:b.xpv_asset_id)!=null){a.setRequestHeader("xpv_asset_id",String((b=this.receiveParameters)==null?void 0:b.xpv_asset_id))}if(((b=this.receiveParameters)==null?void 0:b.is_xpv_single_prod)!=null){a.setRequestHeader("is_xpv_single_prod",String((b=this.receiveParameters)==null?void 0:b.is_xpv_single_prod))}};f.resume=function(a){var e=this,f=this.getServiceName();f=d("ConstUriUtils").getUri("https://"+f+"/"+this.consumer+"/"+this.sessionKey);f!=null&&this.contentKey&&this.contentValue&&(f=f.addQueryParam(this.contentKey,this.contentValue));if(f==null){var g=new Error("ResumableUploadService: Invalid uploadURI");g.stack;throw g}var i=f.toString();g=function(){return new(h||(h=b("Promise")))(function(a,b){a=new(c("AsyncRequest"))().setAllowCrossOrigin(!0).setAllowCredentials(!0).setMethod("GET").setURI(i).setReadOnly(!0).setHandler(a).setErrorHandler(b).setOption("suppressEvaluation",!0).setTransportErrorHandler(function(a){e.emit(c("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,a,{method:"GET"})});e.accessToken&&a.setRequestHeader("Authorization","OAuth "+e.accessToken);e.$ResumableUploadServiceBlue$p_1(a);self.$ResumableUploadServiceBlue2=a;a.send()})};f=function(d){return new(h||(h=b("Promise")))(function(b,f){var g=0;if(d!==void 0){var h=JSON.parse(d.payload.response);g=h.offset}e.emit(c("ResumableUploadServiceState.enum").START,{offset:g});self.$ResumableUploadServiceBlue2=new(c("AsyncRequest"))().setAllowCrossOrigin(!0).setAllowCredentials(!0).setURI(i).setRawData(a.slice(g)).setHandler(b).setErrorHandler(f).setRequestHeader("X-Entity-Name",encodeURIComponent(a.name)).setRequestHeader("X-Entity-Type",a.type).setRequestHeader("X-Entity-Length",String(a.size)).setRequestHeader("Offset",String(g)).setOption("suppressEvaluation",!0).setUploadProgressHandler(function(b){b=new ProgressEvent("upload-service",{total:a.size,loaded:b.loaded+Number(g)});e.emit(c("ResumableUploadServiceState.enum").PROGRESS,b)}).setTransportErrorHandler(function(a){e.emit(c("ResumableUploadServiceState.enum").TRANSPORT_FAILURE,a,{method:"POST",offset:g})});e.accessToken&&self.$ResumableUploadServiceBlue2.setRequestHeader("Authorization","OAuth "+e.accessToken);e.$ResumableUploadServiceBlue$p_1(self.$ResumableUploadServiceBlue2);if(e.receiveParameters){h=e.receiveParameters;self.$ResumableUploadServiceBlue2.setRequestHeader("start_offset",String(h.start_offset));self.$ResumableUploadServiceBlue2.setRequestHeader("end_offset",String(h.end_offset));self.$ResumableUploadServiceBlue2.setRequestHeader("composer_session_id",String(h.composer_session_id));self.$ResumableUploadServiceBlue2.setRequestHeader("id",String(h.upload_session_id));self.$ResumableUploadServiceBlue2.setRequestHeader("product_media_id",String(h.product_media_id));h.fb_region&&self.$ResumableUploadServiceBlue2.setRequestHeader("X-FB-Region",String(h.fb_region));h.total_file_size&&self.$ResumableUploadServiceBlue2.setRequestHeader("X-Total-Asset-Size",String(h.total_file_size))}e.thriftParams.size>0&&self.$ResumableUploadServiceBlue2.setRequestHeader("X-Thrift-Params",JSON.stringify(Object.fromEntries(e.thriftParams.entries())));e.tracingHeaderValue&&self.$ResumableUploadServiceBlue2.setRequestHeader("x-fb-product-log",e.tracingHeaderValue);if(e.customHttpHeaders.size>0)for(b of e.customHttpHeaders){f=b[0];h=b[1];self.$ResumableUploadServiceBlue2.setRequestHeader(f,h)}self.$ResumableUploadServiceBlue2.send()})};var j=function(a){if(a!=null){a=JSON.parse(a.payload.response);a.h!=null?e.emit(c("ResumableUploadServiceState.enum").SUCCESS,a.h):e.emit(c("ResumableUploadServiceState.enum").SUCCESS,a)}else e.emit(c("ResumableUploadServiceState.enum").FAIL,"uploading failed")},k=function(a){return e.emit(c("ResumableUploadServiceState.enum").FAIL,a)};g=this.skipOffsetFetching?(h||(h=b("Promise"))).resolve():g();return g.then(f,k).then(j,k)};f.getServiceName=function(){return this.serviceName+"."+this.serviceDomain};f.cancel=function(){self.$ResumableUploadServiceBlue2&&self.$ResumableUploadServiceBlue2.abort(),this.emit(c("ResumableUploadServiceState.enum").CANCEL)};f.emitFileSizeWarning=function(a){this.emit(c("ResumableUploadServiceState.enum").FILE_TOO_LARGE,a)};return e}(c("EventEmitter"));g["default"]=a}),98);
__d("VideoUploadCallbacksMixin",[],(function(a,b,c,d,e,f){"use strict";function g(a){return Array.isArray(a)?a:[a]}a={inform:function(a,b){var c=this.__callbacksByType;if(c==null)return;a=g(a);a.forEach(function(a){var d=c[a];if(d==null)return;d.forEach(function(c){try{c(a,b)}catch(a){}})})},subscribe:function(a,b){var c,d=this.__callbacksByType=(c=this.__callbacksByType)!=null?c:{},e=g(a);e.forEach(function(a){a=d[a]=(a=d[a])!=null?a:[];a.push(b)});var f=!1;return{remove:function(){if(f===!0)return;f=!0;e.forEach(function(a){var c=d[a];if(c==null)return;var e=c.indexOf(b);e!==-1&&c.splice(e,1);c.length===0&&delete d[a]})}}}};e.exports=a}),null);